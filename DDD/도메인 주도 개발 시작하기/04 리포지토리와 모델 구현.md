# JPAë¥¼ ì´ìš©í•œ ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„

ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ëŠ” ì• ê·¸ë¦¬ê±°íŠ¸ì™€ ê°™ì€ ë„ë©”ì¸ ì˜ì—­ì— ì†í•˜ê³ , ë¦¬í¬ì§€í† ë¦¬ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ëŠ” ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ì˜ì—­ì— ì†í•œë‹¤.

<p align="center"><img width="700" alt="ìŠ¤í¬ë¦°ìƒ· 2023-06-25 ì˜¤í›„ 11 07 06" src="https://github.com/b2aconnn/TIL/assets/89119477/0d9c4110-d6a8-4e1f-93b3-af7db648231c"></p>

<p align="center">DIP ì ìš©í•  ê²½ìš° êµ¬í˜„ í´ë˜ìŠ¤ëŠ” ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì³ ì˜ì—­ì— ìœ„ì¹˜</p>

<br>

## ë¦¬í¬ì§€í† ë¦¬ ê¸°ë³¸ ê¸°ëŠ¥ êµ¬í˜„

- IDë¥¼ í†µí•œ ì• ê·¸ë¦¬ê±°íŠ¸ ì¡°íšŒ
- ì• ê·¸ë¦¬ê±°íŠ¸ ì €ì¥

<br>

**ë‘ ê¸°ëŠ¥ì„ ì¸í„°í˜ì´ìŠ¤ë¡œ í‘œí˜„**

~~~java
public interface OrderRepository {
    Order findById(OrderNo no);
    void save(Order order);
}
~~~

ì¸í„°í˜ì´ìŠ¤ëŠ” ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ì„ í•œë‹¤. 

ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì˜ ì´ë¦„ì„ ì§€ì„ ë•ŒëŠ” ë³´í†µ findByí”„ë¡œí¼í‹°ì´ë¦„(í”„ë¡œí¼í‹° ê°’) í˜•ì‹ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.

<br>

**ìœ„ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ JPAì˜ EntityManagerë¡œ êµ¬í˜„í•œ í´ë˜ìŠ¤**

~~~java
@Repository
class JpaOrderRepository implements OrderRepository {
    @PersistenceContext
    private EntityManager entityManager;

    @Override
    public Order findById(OrderNo id) {
        // Idë¥¼ í†µí•´ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ì¡°íšŒ
        return entityManager.find(Order.class, id);
    }

    @Override
    public void save(Order order) {
        // ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ì €ì¥
        entityManager.persist(order);
    }
}
~~~

<br>

**ì• ê·¸ë¦¬ê±°íŠ¸ì˜ ìˆ˜ì •**

~~~java
public class ChangeOrderService {
    @Transactional
    public void changeShippingInfo(OrderNo no, ShippingInfo newShippingInfo) {
        Optional<Order> orderOpt = orderRepository.findById(no);
        Order order = orderOpt.orElseThrow(() -> new OrderNotFoundException());
        // ì• ê·¸ë¦¬ê±°íŠ¸ ìˆ˜ì •
        order.changeShippingInfo(newShippingInfo);
    }
}
~~~

**ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ìˆ˜ì •í•œ í›„ì— ì €ì¥ì†Œì— ë°˜ì˜í•˜ëŠ” ë©”ì†Œë“œë¥¼ ë”°ë¡œ í˜¸ì¶œí•  í•„ìš”ê°€ ì—†ë‹¤.**

JPAë¥¼ ì‚¬ìš©í•˜ë©´ íŠ¸ë™ì­ì…˜ ë²”ìœ„ì—ì„œ ë³€ê²½í•œ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ UPDATE ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì—¬ DBì— ë°˜ì˜ì„ í•´ì£¼ê¸° ë•Œë¬¸ì´ë‹¤.

<br>

**ì• ê·¸ë¦¬ê±°íŠ¸ ì¡°íšŒ**

~~~java
public interface OrderRepository {
    List<Order> findByOrdererId(String ordererId, int startRow, int size);
}
~~~

JPAì—ì„œ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” findByë’¤ì— ì¡°ê±´ ëŒ€ìƒì´ ë˜ëŠ” í”„ë¡œí¼í‹°ëª…ì„ ë¶™ì´ë©´ ëœë‹¤.

ë˜ JPAì˜ Criteriaë‚˜ JPQL, queryDSL ë“±ìœ¼ë¡œ ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

<br>

**ì• ê·¸ë¦¬ê±°íŠ¸ ì‚­ì œ**

~~~java
public interface OrderRepository {
    public void delete(Order order);
}
~~~

ì‚­ì œí•  ì• ê·¸ë¦¬ê±°íŠ¸ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•˜ë©´ ëœë‹¤.

â—ï¸ë³´í†µì€ ì‹¤ì œë¡œ ë¬¼ë¦¬ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì‚­ì œ(hardDelete)í•˜ì§€ ì•ŠëŠ”ë‹¤. ë°ì´í„° ì›ë³µì´ë‚˜ ì¼ì • ê¸°ê°„ ë™ì•ˆ ë°ì´í„°ë¥¼ ë³´ê´€í•´ì•¼ í•  ë•Œë„ ìˆê¸° ë•Œë¬¸ì— ë³´í†µì€ ë…¼ë¦¬ì ì¸ ì‚­ì œ(softDelete)ë¥¼ í†µí•´ ê´€ë¦¬ë¥¼ í•œë‹¤.

<br>

# ë§¤í•‘ êµ¬í˜„

## ì—”í‹°í‹°ì™€ ë°¸ë¥˜ ê¸°ë³¸ ë§¤í•‘ êµ¬í˜„

**ì• ê·¸ë¦¬ê±°íŠ¸ì™€ JPA ë§¤í•‘ì„ ìœ„í•œ ê¸°ë³¸ ê·œì¹™**

- ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸ëŠ” ì—”í‹°í‹°ì´ë¯€ë¡œ @Entityë¡œ ë§¤í•‘ ì„¤ì •

**í•œ í…Œì´ë¸”ì— ì—”í‹°í‹°ì™€ ë°¸ë¥˜ê°€ ê°™ì´ ìˆë‹¤ë©´?**

- ë°¸ë¥˜ëŠ” @Embeddableë¡œ ë§¤í•‘ ì„¤ì •
- ë°¸ë¥˜ íƒ€ì… í”„ë¡œí¼í‹°ëŠ” @Embeddedë¡œ ë§¤í•‘ ì„¤ì •

<br>

ğŸ‘‰ ì£¼ë¬¸ ì• ê·¸ë¦¬ê±°íŠ¸ì˜ ì˜ˆ

- ë£¨íŠ¸ ì—”í‹°í‹° : Order
- ë°¸ë¥˜ : Orderer, ShippingInfo, Address, Receiver

<p align="center"><img width="700" alt="ìŠ¤í¬ë¦°ìƒ· 2023-07-10 ì˜¤í›„ 11 54 43" src="https://github.com/b2aconnn/TIL/assets/89119477/1e7c3455-ca80-4181-84cc-81a18a84b22e"></p>

<br>

### JPAì™€ ë§¤í•‘

ë£¨íŠ¸ ì—”í‹°í‹°ì¸ OrderëŠ” JPAì˜ @Entityë¡œ ë§¤í•‘

~~~java
@Entity
@Table(name = "purchase_order")
public class Order {
    // ...
}
~~~

<br>

Orderì— ì†í•˜ëŠ” OrdererëŠ” ë°¸ë¥˜ì´ë¯€ë¡œ @Embeddableë¡œ ë§¤í•‘

~~~java
@Embeddable
public class Orderer {
    // MemberIdì— ì •ì˜ëœ ì»¬ëŸ¼ ì´ë¦„ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ @AttributeOverride ì‚¬ìš©
    @Embedded
    @AttributeOverrides(
        @AttributeOverride(name = "id", column = @Column(name = "orderer_id"))
    )
    private MemberId memberId;

    @Column(name = "orderer_name")
    private String name;
}

@Embeddable
public class MemberId implements Serializable {
    @Column(name = "member_id")
    private String id;
}
~~~

<br>

ë£¨íŠ¸ ì—”í‹°í‹° Order í´ë˜ìŠ¤ëŠ” @Embeddedë¥¼ ì„ ì–¸í•´ ë°¸ë¥˜ íƒ€ì… í”„ë¡œí¼í‹°ë¥¼ ì„¤ì •

~~~java
@Entity
public class Order {
    @Embedded
    private Orderer orderer;
    @Embedded
    private ShippingInfo shippingInfo;
}
~~~

<br>

## ê¸°ë³¸ ìƒì„±ì

**ReceiverëŠ” ë°¸ë¥˜ì´ê³ , ë¶ˆë³€ íƒ€ì…ìœ¼ë¡œ ë§Œë“¤ë ¤ë©´ ìƒì„± ì‹œì ì— í•„ìš”í•œ ê°’ë“¤ì„ ìƒì„±ìë¥¼ í†µí•´ ëª¨ë‘ ì „ë‹¬ ë°›ìœ¼ë¯€ë¡œ set ë©”ì„œë“œë¥¼ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤. ì¦‰, ê¸°ë³¸ ìƒì„±ìëŠ” í•„ìš” ì—†ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸**í•œë‹¤.

<br>

â—ï¸í•˜ì§€ë§Œ JPAì—ì„œ @Entityì™€ @Embeddableë¡œ í´ë˜ìŠ¤ë¥¼ ë§¤í•‘í•˜ë ¤ë©´ ê¸°ë³¸ ìƒì„±ìê°€ í•„ìš”í•¨

- DBì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ì™€ì„œ ë§¤í•‘ëœ ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ê¸°ë³¸ ìƒì„±ìë¥¼ ì‚¬ìš©í•´ì„œ ê°ì²´ë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸

<br>

ì´ëŸ° ê¸°ìˆ ì ì¸ ì œì•½ìœ¼ë¡œ ì¸í•´ Receiverì™€ ê°™ì€ ë¶ˆë³€ íƒ•ë¹„ì€ ê¸°ë³¸ ìƒì„±ìê°€ í•„ìš” ì—†ìŒì—ë„ ê¸°ë³¸ ìƒì„±ìë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤. ğŸ˜¢

~~~java
@Embeddable
public class Receiver {
    @Column(name = "receiver_name")
    private String name;
    @Column(name = "receiver_phone")
    private String phone;

    protected Receiver() {} // JPAë¥¼ ì ìš©í•˜ê¸° ìœ„í•œ ê¸°ë³¸ ìƒì„±ì ì¶”ê°€

    public Receiver(String name, String phone) {
        this.name = name;
        this.phone = phone;
    }
}
~~~

**ê¸°ë³¸ ìƒì„±ìëŠ” JPA Providerê°€ ê°ì²´ë¥¼ ìƒì„±í•  ë•Œë§Œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ì½”ë“œì—ì„œëŠ” ê¸°ë³¸ ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ë„ë¡ protected ì ‘ê·¼ ì œí•œìë¥¼ í†µí•´ ì œí•œí•œë‹¤.**

<br>

## í•„ë“œ ì ‘ê·¼ ë°©ì‹ ì‚¬ìš©

JPAëŠ” í•„ë“œì™€ ë©”ì„œë“œ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ë§¤í•‘ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

- ë©”ì„œë“œ ë°©ì‹ : í”„ë¡œí¼í‹°ë¥¼ ìœ„í•œ get/set ë©”ì„œë“œë¥¼ êµ¬í˜„

~~~java
@Entity
@Access(AccessType.PROPERTY)
public class Order {
    @Column(name = "state")
    @Enumerated(EnumType.STRING)
    public OrderState getState() {
        return state;
    }
    
    public setState(OrderState state) {
        this.state = state;
    }
}
~~~

â—ï¸ ìœ„ì™€ ê°™ì´ ë©”ì„œë“œ ë°©ì‹ì„ í†µí•´ í”„ë¡œí¼í‹°ë¥¼ ìœ„í•œ set ë©”ì„œë“œë¥¼ ë§Œë“¤ê²Œ ë˜ë©´ ë‚´ë¶€ ë°ì´í„°ë¥¼ ì™¸ë¶€ì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì„ ì—´ì–´ë‘ê¸° ë•Œë¬¸ì— ìº¡ìŠí™”ë¥¼ ê¹¨ëŠ” ì›ì¸ì´ ë˜ì–´ ê°ì²´ë¡œì„œ ì œ ì—­í• ì„ í•˜ì§€ ëª» í•  ìˆ˜ ìˆë‹¤.

<br>

- í•„ë“œ ë°©ì‹

~~~java
@Entity
@Access(AccessType.FIELD)
public class Order {
    @EmbeddedId
    private OrderNo number;

    @Column(name = "state")
    @Enumerated(EnumType.STRING)
    private OrderState state;
    
    public void cancel() { // ëª…í™•í•œ ì˜ë„ë¡œ ë„ë©”ì¸ ê¸°ëŠ¥ êµ¬í˜„
        // ...
    }
}
~~~

set ë©”ì„œë“œ ëŒ€ì‹  ëª…í™•í•œ ì˜ë„ê°€ ë“œëŸ¬ë‚˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ë¯€ë¡œì¨ ë„ë©”ì¸ì„ ë” ì˜ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

<br>

## AttributeConverterë¥¼ ì´ìš©í•œ ë°¸ë¥˜ ë§¤í•‘ ì²˜ë¦¬

Integer, String LocalDateTimeê³¼ ê°™ì€ íƒ€ì…ì€ DB í…Œì´ë¸”ì˜ í•œ ê°œì˜ ì»¬ëŸ¼ì— ë§¤í•‘ë˜ì–´ì„œ ì €ì¥ì´ ê°€ëŠ¥í•˜ë‹¤.

ë°¸ë¥˜ íƒ€ì…ì˜ í”„ë¡œí¼í‹°ë¥¼ í•œ ê°œ ì»¬ëŸ¼ì— ë§¤í•‘í•´ì•¼ í•  ë•Œì—ëŠ” @Embeddableë¡œ ì²˜ë¦¬í•  ìˆ˜ ì—†ë‹¤.

<p align="center"><img width="600" alt="ìŠ¤í¬ë¦°ìƒ· 2023-07-12 ì˜¤í›„ 9 16 00" src="https://github.com/b2aconnn/TIL/assets/89119477/c2f83622-d96f-4390-891f-88b2e9470a15"></p>

ğŸ‘‰ **ë°¸ë¥˜ íƒ€ì…ì˜ ë‘ ê°œ ì´ìƒì˜ í”„ë¡œí¼í‹°ë¥¼ í•œ ê°œì˜ ì»¬ëŸ¼ìœ¼ë¡œ ë§¤í•‘í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ AttributeConverterê°€ ìˆë‹¤.**

~~~java
public interface AttributeConverter<X, Y> { // X: ë°¸ë¥˜ íƒ€ì…, Y: DB íƒ€ì…
    public Y convertToDatabaseColumn(X attribute); // ë°¸ë¥˜ íƒ€ì… -> DB ì»¬ëŸ¼ ê°’ìœ¼ë¡œ ë³€í™˜
    public X convertToEntityAttribute(Y dbData); // DB ì»¬ëŸ¼ ê°’ -> ë°¸ë¥˜ íƒ€ì… ê°’ìœ¼ë¡œ ë³€í™˜
}
~~~

<br>

**Money ë°¸ë¥˜ íƒ€ì…ì„ ìœ„í•œ AttributeConverter êµ¬í˜„**

~~~java
@Converter(autoApply = true)
public class MoneyConverter implements AttributeConverter<Money, Integer> {
    @Override
    public Integer convertToDatabaseColumn(Money money) {
        return money == null ? null : money.getValue();
    }
    
    @Override
    public Money convertToEntityAttribute(Integer value) {
        return value == null ? null : new Money(value);
    }
}
~~~

- AttributeConverterì˜ êµ¬í˜„ í´ë˜ìŠ¤ëŠ” @Converter ì ìš©í•´ì•¼ í•¨
- autoApply ì†ì„±ì˜ ê°’ìœ¼ë¡œ trueë¥¼ ì§€ì •í•˜ë©´ Money íƒ€ì…ì˜ í”„ë¡œí¼í‹°ì— ëŒ€í•´ MoneyConverterë¥¼ ìë™ìœ¼ë¡œ ì ìš©

<br>

**MoneyConverterê°€ ì ìš©ëœ Order Entity**

~~~java
@Entity
@Table(name = "purchase_order")
public class Order {
    // ...
    
    @Column(name = "total_amounts")
    private Money totalAmounts; // MoneyConverterë¥¼ ì ìš©í•´ì„œ ê°’ ë³€í™˜
}
~~~

<br>

**autoApply = falseì¼ ê²½ìš° ì§ì ‘ ì»¨ë²„í„° ì§€ì •**

~~~java
public class Order {
    @Column(name = "total_amounts")
    @Convert(converter = MoneyConverter.class)
    private Money totalAmounts;
}
~~~

<br>

## ë°¸ë¥˜ ì»¬ë ‰ì…˜: ë³„ë„ í…Œì´ë¸” ë§¤í•‘

Order EntityëŠ” í•œ ê°œ ì´ìƒì˜ OrderLineì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

<br>

**ìˆœì„œë¥¼ ê°€ì§€ëŠ” OrderLineì„ í¬í•¨í•œ Order Entity**

~~~java
public class Order {
    private List<OrderLine> orderLines;
    // ...
}
~~~

<br>

ë°¸ë¥˜ ì»¬ë ‰ì…˜ì¸ **`List<OrderLine>`** ì„ ë³„ë„ í…Œì´ë¸”ë¡œ ë§¤í•‘í•  ë•ŒëŠ” **`@ElementCollection`** ê³¼ **`@CollectionTable`**ì„ í•¨ê»˜ ì‚¬ìš©

~~~java
@Entity
@Table(name = "purchase_order")
public class Order {
    @EmbeddedId
    private OrderNo number;

    @ElementCollection(fetch = FetchType.EAGER)
    @CollectionTable(name = "order_line",
               joinColumns = @JoinColumn(name = "order_number"))
    @OrderColumn(name = "line_idx")
    private List<OrderLine> orderLines;
    
    // ...
}

@Embeddable
public class OrderLine {
    @Embedded
    private ProductId productId;
    
    @Column(name = "price")
    private Money price;
    
    @Column(name = "quantity")
    private int quantity;
    
    @Column(name = "amounts")
    private Money amounts;
}
~~~

- @OrderColumn : ì§€ì •í•œ ì»¬ëŸ¼ì— ë¦¬ìŠ¤íŠ¸ì˜ ì¸ë±ìŠ¤ ê°’ì„ ì €ì¥
  - line_idxë¼ëŠ” DB ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ê°€ ì €ì¥ë¨
- @CollectionTable : ë°¸ë¥˜ë¥¼ ì €ì¥í•  í…Œì´ë¸”ì„ ì§€ì •
  - name ì†ì„± : í…Œì´ë¸” ì´ë¦„ ì§€ì •
  - joinColumns ì†ì„± : ì™¸ë¶€í‚¤ë¡œ ì‚¬ìš©í•  ì»¬ëŸ¼ ì§€ì •

<br>

## ë°¸ë¥˜ ì»¬ë ‰ì…˜: í•œê°œ ì»¬ëŸ¼ ë§¤í•‘

ë°¸ë¥˜ ì»¬ë ‰ì…˜ì„ ë³„ë„ í…Œì´ë¸”ì´ ì•„ë‹Œ **í•œ ê°œ ì»¬ëŸ¼ì— ì €ì¥í•´ì•¼ í•  ë•Œ AttributeConverterë¥¼ ì‚¬ìš©í•˜ì—¬ ë§¤í•‘í•  ìˆ˜ ìˆë‹¤.**

AttributeConverterë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë°¸ë¥˜ ì»¬ë ‰ì…˜ì„ í‘œí˜„í•˜ëŠ” ë°¸ë¥˜ íƒ€ì…ì„ í•˜ë‚˜ ì¶”ê°€í•´ì•¼ í•œë‹¤.

<br>

**Email ì£¼ì†Œ ëª©ë¡ì˜ ë°¸ë¥˜ íƒ€ì… í´ë˜ìŠ¤**

~~~java
public class EmailSet {
    private Set<Email> emails = new HashSet<>(); // ë°¸ë¥˜ ì»¬ë ‰ì…˜

    public EmailSet(Set<Email> emails) {
        this.emails.addAll(emails);
    }

    public Set<Email> getEmails() {
        return Collections.unmodifiableSet(emails);
    }
}
~~~

<br>

**AttributeConverter êµ¬í˜„**

~~~java
public class EmailSetConverter implements AttributeConverter<EmailSet, String> {
    @Override
    public String convertToDatabaseColumn(EmailSet attribute) {
        // ...
    }

    @Override
    public EmailSet convertToEntityAttribute(String dbData) {
        // ...
    }
}
~~~

<br>

**Converter ì§€ì •**

~~~java
@Column(name = "emails")
@Convert(converter = EmailSetConverter.class)
private EmailSet emailSet;
~~~

<br>

## ë°¸ë¥˜ë¥¼ ì´ìš©í•œ ID ë§¤í•‘

ë°¸ë¥˜ íƒ€ì…ì„ ì‹ë³„ìë¡œ ë§¤í•‘í•˜ë ¤ë©´ @Idê°€ ì•„ë‹Œ @EmbeddedIdë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

~~~java
@Embeddable
public class OrderNo implements Serializable {
    @Column(name = "order_number")
    private String number;
    
    public boolean is2ndGeneration() {
        return number.startsWith("N");
    }
}
~~~

ğŸ’â€â™‚ï¸ **ë°¸ë¥˜ íƒ€ì…ìœ¼ë¡œ ì‹ë³„ìë¥¼ êµ¬í˜„í•  ë•Œ ì–»ì„ ìˆ˜ ìˆëŠ” ì¥ì ì€ ì‹ë³„ìì— ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.**

- 1ì„¸ëŒ€ ì‹œìŠ¤í…œ ì£¼ë¬¸ ë²ˆí˜¸ì™€ 2ì„¸ëŒ€ ì‹œìŠ¤í…œì˜ ì£¼ë¬¸ ë²ˆí˜¸ë¥¼ êµ¬ë¶„í•  ë•Œ ì²« ê¸€ìë¥¼ ì´ìš©í•  ê²½ìš°, is2ndGeneration() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì„œ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

ğŸ‘‰ JPAëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì—”í‹°í‹°ë¥¼ ë¹„êµí•  ëª©ì ìœ¼ë¡œ equals()ì™€ hashcode() ê°’ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ì‹ë³„ìë¡œ ë°¸ë¥˜ íƒ€ì…ì„ ì‚¬ìš©í•  ê²½ìš° ë‘ ë©”ì„œë“œë¥¼ ì•Œë§ê²Œ êµ¬í˜„í•´ì•¼ í•œë‹¤.

<br>

## ë³„ë„ í…Œì´ë¸”ì— ì €ì¥í•˜ëŠ” ë°¸ë¥˜ ë§¤í•‘

ì• ê·¸ë¦¬ê±°íŠ¸ì—ì„œ ë£¨íŠ¸ ì—”í‹°í‹°ë¥¼ ì œì™¸í•œ êµ¬ì„±ìš”ì†ŒëŠ” ëŒ€ë¶€ë¶„ ë°¸ë¥˜ì´ë‹¤.

<br>

ğŸ’â€â™‚ï¸ **ë°¸ë¥˜ì¸ ì§€ ì—”í‹°í‹°ì¸ ì§€ êµ¬ë¶„í•˜ëŠ” ë°©ë²•ì€ ê³ ìœ  ì‹ë³„ìë¥¼ ê°–ëŠ” ì§€ì˜ ì—¬ë¶€ì— ë”°ë¼ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.**

- ë³„ë„ í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤ê³  í•´ì„œ ì—”í‹°í‹°ì¸ ê²ƒì€ ì•„ë‹ˆë‹¤.
- ì‹ë³„ìë¥¼ ì°¾ì„ ë•Œ ë§¤í•‘ë˜ëŠ” í…Œì´ë¸”ì˜ ì‹ë³„ìë¥¼ ì• ê·¸ë¦¬ê±°íŠ¸ êµ¬ì„±ìš”ì†Œì˜ ì‹ë³„ìì™€ ë™ì¼í•œ ê²ƒìœ¼ë¡œ ì°©ê°í•´ì„  ì•ˆëœë‹¤.
  - ë³„ë„ í…Œì´ë¸”ë¡œ ì €ì¥í•˜ê³  í…Œì´ë¸”ì— PKê°€ ìˆë‹¤ê³  í•´ì„œ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” ì• ê·¸ë¦¬ê±°íŠ¸ êµ¬ì„±ìš”ì†Œê°€ í•­ìƒ ê³ ìœ  ì‹ë³„ìë¥¼ ê°–ëŠ” ê²ƒì€ ì•„ë‹ˆê¸° ë•Œë¬¸

<br>

<p align="center"><img width="500" alt="ìŠ¤í¬ë¦°ìƒ· 2023-07-14 ì˜¤ì „ 12 13 31" src="https://github.com/b2aconnn/TIL/assets/89119477/354ab74d-d82f-4120-bbc7-f4a29da6e7eb"></p>

<p align="center">ë°¸ë¥˜ë¥¼ ì—”í‹°í‹°ë¡œ ì˜ëª» ë§¤í•‘í•œ ì˜ˆ</p>

<br>

ARTICLE í…Œì´ë¸”ê³¼ ARTICLE_CONTENT í…Œì´ë¸”ì˜ 1:1 ê´€ê³„ì´ë‹¤. 

ARTICLE_CONTENT í…Œì´ë¸”ì— ìˆëŠ” **ID ê°’ì´ ì‹ë³„ì ì—­í• ë„ ê°€ëŠ¥ì€ í•˜ì§€ë§Œ ARTICLE í…Œì´ë¸”ê³¼ ì—°ê´€ê´€ê³„ë¥¼ ê°–ê¸° ìœ„í•¨ì´ê¸° ë•Œë¬¸ì— ì—”í‹°í‹°ë¡œ  íŒë‹¨í•˜ê¸°ë³´ë‹¨ ë°¸ë¥˜ë¡œ íŒë‹¨í•˜ëŠ” ê²ƒì´ ë” ì˜¬ë°”ë¥¸ ì„¤ê³„ì¼ ìˆ˜ ìˆë‹¤.**

ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê²Œì‹œê¸€ì˜ íŠ¹ì • í”„ë¡œí¼í‹°ë¥¼ ë³„ë„ í…Œì´ë¸”ì— ë³´ê´€í•˜ëŠ” ê²ƒìœ¼ë¡œ ì ‘ê·¼í•´ì•¼ í•œë‹¤.

<br>

<p align="center"><img width="500" alt="ìŠ¤í¬ë¦°ìƒ· 2023-07-14 ì˜¤ì „ 12 26 48" src="https://github.com/b2aconnn/TIL/assets/89119477/8ab4ae89-9c62-4a62-b95c-2b0ed3e92b82"></p>

<p align="center">ë³„ë„ í…Œì´ë¸”ë¡œ ë°¸ë¥˜ë¥¼ ë§¤í•‘í•œ ëª¨ë¸</p>

<br>

**@SecondaryTableì„ ì´ìš©í•œ ë°¸ë¥˜ ë§¤í•‘ ì„¤ì •**

~~~java
@Entity
@Table(name ="atricle")
@SecondaryTable(
        name = "article_content",
        pkJoinColumns = @PrimaryKeyJoinColumn(name = "id")
)
public class Article {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String title;

    @AttributeOverrides({
            @AttributeOverride(
                    name = "content",
                    column = @Column(table = "article_content", name = "content")),
            @AttributeOverride(
                    name = "contentType",
                    column = @Column(table = "article_content", name = "content_type"))
    })
    @Embedded
    private ArticleContent content;
}
~~~

- ArticleContentëŠ” ë°¸ë¥˜ì´ë¯€ë¡œ @Embeedableë¡œ ë§¤í•‘

- @SecondaryTable, @AttributeOverride : ë°¸ë¥˜ë¥¼ ë§¤í•‘í•œ í…Œì´ë¸”ì„ ì§€ì •

  - @SecondaryTable

    - name ì†ì„± : ë°¸ë¥˜ë¥¼ ì €ì¥í•  í…Œì´ë¸”ì„ ì§€ì •

    - pkJoinColumns ì†ì„± : ë°¸ë¥˜ í…Œì´ë¸”ì—ì„œ ì—”í‹°í‹° í…Œì´ë¸”ë¡œ ì¡°ì¸í•  ë•Œ ì‚¬ìš©í•  ì»¬ëŸ¼ ì§€ì •

<br>

ğŸ‘‰ **@SecondaryTableì„ ì´ìš©í•˜ë©´ Article ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ArticleContentë„ ê°™ì´ ì¡°íšŒëœë‹¤.**

~~~java
@SecondaryTableë¡œ ë§¤í•‘ëœ article_content í…Œì´ë¸”ì„ ì¡°ì¸
Article article = entityManager.find(Article.class, 1L);
~~~

- article í…Œì´ë¸”ì˜ ë°ì´í„°ë§Œ í•„ìš”í•  ë•Œ ë¶ˆí•„ìš”í•˜ê²Œ article_content í…Œì´ë¸”ì˜ ë°ì´í„°ê¹Œì§€ ì¡°íšŒëœë‹¤.

ì§€ì—° ë¡œë”© ë°©ì‹ì„ ì„¤ì •í•´ì„œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì§€ë§Œ í•˜ì§€ë§Œ ë°¸ë¥˜ ëª¨ë¸ì„ ì—”í‹°í‹°ë¡œ ë§Œë“¤ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì¢‹ì€ ë°©ë²•ì€ ì•„ë‹ˆë‹¤. ğŸ˜¢

<br>

ğŸ’¡ **ìœ„ì™€ ê°™ì€ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì§€ì—° ë¡œë”© ëŒ€ì‹  ì¡°íšŒ ì „ìš© ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.**

<br>

