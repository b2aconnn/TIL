# **도메인이란?**

**소프트웨어로 해결하고자 하는 문제 영역**



# 도메인 모델 패턴

일반적으로 애플리케이션의 아키텍처는 네 개의 영역으로 구성한다.

- 사용자 인터페이스 또는 표현
- 응용
- 도메인
- 인프라스터럭처

## 개념 모델과 구현 모델

개념 모델은 순수하게 문제를 분석한 결과물이다.  처음부터 완벽한 개념 모델을 만들기보다는 전반적인 개요를 알 수 있는 수준으로 개념 모델을 작성해야 한다. 프로젝트 초기에는 개요 수준의 개념 모델로 도메인에 대한 전체 윤곽을 이해하는데 집중하고, 구현하는 과정에서 개념 모델을 구현 모델로 점진적으로 발전시켜 나가야 한다.



# 도메인 모델 도출

어떠한 개발자라도 도메인에 대한 이해 없이 코딩을 시작할 수 없다. 구현을 시작하려면 도메인에 대한 초기 모델이 필요하다.

도메인을 모델링할 때 기본이 되는 작업은 모델을 구성하는 핵심 구성요소, 규칙, 기능을 찾는 것이다.

이 과정은 **요구사항에서 출발한다.**



# 문서화

문서화를 하는 주된 이유는 지식을 공유하기 위함이다. 

전반적인 기능 목록이나 모듈 구조, 빌드 과정은 코드를 보고 직접 이해하는 것보다 상위 수준에서 정리한 문서를 참조하는 것이 소프트웨어 전반을 빠르게 이해하는데 도움이 된다.

코드를 보면서 도메인을 깊게 이해하게 되므로 코드 자체도 문서화의 대상이 된다. **단순히 코드를 보기 좋게 작성하는 것뿐만 아니라 도메인 관점에서 코드가 도메인을 잘 표현해야 비로소 코드의 가독성이 높아지고 문서로서 코드가 의미를 갖는다.**



# 엔티티와 밸류

도출한 모델은 크게 엔티티, 밸류로 구분할 수 있다. 



## 엔티티

- **엔티티의 가장 큰 특징은 식별자를 가지는 것**

- 엔티티를 생성하고 속성을 바꾸고 삭제할 때까지 식별자는 바뀌지 않고 고유하기 때문에 엔티티 객체의 식별자가 같으면 두 엔티티는 같다고 판단할 수 있음

  

#### 엔티티의 식별자 생성

- 특정 규칙에 따라 생성
  - ex. 주문 번호
- 고유 식별자 생성기 사용 
  - ex. UUID, Nano ID
- 직접 값을 할당
  - ex. 핸드폰 번호, 이메일
- 일련번호 
  - ex. DB auto increment, sequence
  - DB auto increment 같은 경우 DB 테이블에 저장한 후에 식별자를 확인 가능



## 밸류 타입

- 의미
  - 개념적으로 완전한 하나를 표현할 때 사용
- 특징
  - 밸류 타입을 위한 기능을 추가할 수 있음
    - ex. 정수 타입의 price라는 변수를 Money 밸류 타입으로 표현하게 되면 돈 계산에 대한 기능을 추가할 수 있다
  - **참조 투명성과 스레드에 안전을 위해 불변으로 구현**해야 함



> 여기서 말하는 **참조 투명성이란 함수 외부의 영향을 받지 않는 것을 의미**한다.
>
> 외부에서 변경이 되어도 함수는 항상 일관적으로 반환해야 참조에 투명하다라고 할 수 있다.



#### 밸류 예시

1. 하나의 개념(받는 사람, 주소)을 여러 필드를 통해 표현한 코드

```java
public class ShippingInfo {
    // 받는 사람
    private String receiverName;
    private String receiverPhoneNumber;

    // 주소
    private String shippingAddress1;
    private String shippingAddress2;
    private String shippingZipcode;
    
    // ... 생성자, getter, equals, hashcode
}
```



2. 밸류 타입으로 개념을 표현한 코드

```json
public class Receiver {
    private String name;
    private String phoneNumber;

    public Receiver(String name, String phoneNumber) {
        this.name = name;
        this.phoneNumber = phoneNumber;
    }
    public String getName() {
        return name;
    }
    public String getPhoneNumber() {
        return phoneNumber;
    }
}
```

1번 코드처럼 이름을 갖고 받는 사람과 관련된 데이터라는 것을 유추한다면 2번 코드는 Receiver 자체로 받는 사람을 표현할 수 있다.



3. 불변 타입으로 작성한 코드

```java
public class Money {
    private final int value;

    public Money(int value) {
        this.value = value;
    }

    public Money add(Money money) {
        return new Money(this.value + money.value);
    }

    public Money multiply(int multiplier) {
        return new Money(value * multiplier);
    }

    // setter 등 value를 변경할 수 있는 메소드 구현 X
}
```



## 도메인 모델에 set 메서드 넣지 않기


