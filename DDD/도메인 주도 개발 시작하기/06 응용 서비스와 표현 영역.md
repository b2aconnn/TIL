# 표현 영역과 응용 영역

**응용 영역과 표현 영역이 사용자와 도메인을 연결해주는 매개체 역할을 한다.**

<p align="center">
  <img width="500" src="https://github.com/b2aconnn/TIL/assets/101120568/270dff5e-2def-4982-ade5-4e4e4e504550"/>
</p>

- **표현 영역 : 사용자의 요청을 해석**
  - URL, 요청 파라미터, 쿠키, 헤더 등을 클라이언트에서 전달 받아 사용자가 실행하고 싶은 기능을 판별 후 그 기능을 제공하는 응용 서비스를 실행
  - 사용자 요청을 응용 서비스에 필요한 데이터 형식으로 변환
  - 응용 서비스의 실행 결과를 사용자에게 알맞는 형식으로 응답 (HTML, JSON 형식 등)
- **응용 영역 : 사용자가 원하는 기능을 제공**
  - 기능에 필요한 값을 메서드 인자로 전달 받아 처리
  - 응용 서비스는 표현 영역에 의존하지 않음
    - 클라이언트가 웹 브라우저인 지 REST API를 호출하는 지, TCP 소켓을 사용하는 지 알 필요가 없다.

<br>

**표현 영역에서 사용자 요청을 응용 서비스에 필요한 객체로 변환**

~~~java
@PostMapping("/member/join")
public ModelAndView join(HttpServletRequest request) {
    String email = request.getParameter("email");
    String password = request.getParameter("password");

    // 사용자 요청을 응용 서비스에 맞게 변환
    JoinRequest joinReq = new JoinRequest(email, password);
    joinService.join(joinReq);

    //...
}
~~~

<br>

# 응용 서비스 역할

**응용 서비스는 클라이언트가 요청한 기능을 실행하는 역할을 한다.**

- 주요 역할은 도메인 객체를 사용해 사용자의 요청을 처리
  - 사용자 요청 처리를 위해 리포지토리에서 도메인 객체를 가져와 사용한다.
- 표현 영역과 도메인 영역을 연결해주는 창구 역할
- **도메인 객체 간의 흐름 제어**
- **트랜잭션 처리 담당**

<br>

**도메인 객체 간의 흐름 제어**

~~~java
public Result doSomeFunc(SomeReq req) {
    // 리포지토리에서 애그리거트 조회
    SomeAgg agg = someAggReposistory.findById(req.getId());
    checkNull(agg);

    // 애그리거트의 도메인 기능 실행
    agg.doFunc(req.getValue());

    // 결과 리턴
    return createSuccessResult(agg);
}
~~~

응용 서비스가 복잡하면 응용 서비스에서 도메인 로직 일부를 구현했을 가능성이 높다. 

**응용 서비스에 도메인 로직 일부를 구현한다면 코드 중복, 로직 분산 등의 코드 품질이 낮아질 수 있다.**

<br>

**트랜잭션 처리 담당**

~~~java
public void blockMembers(String[] blockIds) {
    if (blockIds == null || blockIds.length == 0) return;

    List<Member> members = memberRepository.findByIdIn(blockIds);
    for (Member member : members) {
        member.block();
    }
}
~~~

위와 같이 다수 회원을 한꺼번에 차단 상태로 변경하는 기능을 구현할 때, 트랜잭션 범위에서 실행되지 않을 경우 DB에 반영하는 도중 문제가 발생 시에 일부 Member만 차단이 되어 버리기 때문에 데이터 일관성이 깨져 버린다.

**데이터 일관성을 지켜야 하는 상황이라면 응용 서비스에서 트랜잭션 처리를 하면 된다.**
