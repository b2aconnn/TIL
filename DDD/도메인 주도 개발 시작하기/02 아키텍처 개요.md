# 네 개의 영역

4가지의 아키텍처 설계 영역

- **표현**
  - HTTP 요청을 응용 서비스가 필요로 하는 데이터 형식으로 변환, 응용 서비스가 return한 결과를 JSON 형식으로 변환 후 HTTP 응답을 처리하는 영역
    - 표현 영역의 사용자 : 웹 브라우저, 외부 시스템 등

<p align="center">
  <img width="500" src="https://github.com/b2aconnn/TIL/assets/89119477/ec2cd4f1-8443-4df3-81ae-1b56716e55c2"></p>

<p align="center">출처 : 도메인 주도 개발 시작하기 p.62 [최범균]</p>

- **응용**

  - 사용자에게 제공해야 할 기능을 담당하는 영역

  - 로직을 직접 수행하지 않고 도메인 모델에 로직 수행을 위임함

<p align="center">
  <img width="400" alt="스크린샷 2023-06-07 오후 11 31 01" src="https://github.com/b2aconnn/TIL/assets/89119477/1add16c2-91fb-4c52-b264-e5491894f4af"></p>

<p align="center">출처 : 도메인 주도 개발 시작하기 p.63 [최범균]</p>

- **도메인**
  - 핵심 로직을 담당하는 영역
- **인프라스트럭처**
  - 논리적인 개념을 표현하기보다는 구현 기술에 대한 것을 다루는 영역
    - 데이터 연동, 메세징 큐에 메세지 송수신 등

<p align="center">
	<img width="400" alt="스크린샷 2023-06-08 오후 8 33 54" src="https://github.com/b2aconnn/TIL/assets/89119477/6f1eeb63-3c43-4b28-a7e2-f5c22652c49a"></p>
<br>

# 계층 구조 아키텍처

- 네 영역을 구성할 때 계층 구조를 많이 사용

- 도메인의 복잡도에 따라 응용과 도메인 영역을 분리 또는 한 계층으로 통합

- 계층 구조이기 때문에 상위 계층에서 하위 계층으로의 의존만 존재 (하위 계층이 상위 계층을 의존하지 않음)
  - 도메인 계층이 응용 계층을 의존하지 않음

<p align="center"><img width="300" alt="스크린샷 2023-06-08 오전 1 06 44" src="https://github.com/b2aconnn/TIL/assets/101120568/37c9f7f0-7d6d-467d-99bf-8d9284e17cdd"></p>

<br>

💁‍♂️ 계층 구조를 엄격하게 적용했을 시 상위 계층은 바로 아래의 하위 계층에만 의존을 가져야 하지만 구현의 편리함을 위해서 계층 구조를 유연하게 가져가기도 함

- ex. 응용 계층은 바로 아래 계층인 도메인 계층에 의존하지만 외부 시스템 연동을 위해 인프라스트럭처 계층에 의존하기도 함

<p align="center"><img width="400" alt="스크린샷 2023-06-11 오전 12 12 52" src="https://github.com/b2aconnn/TIL/assets/101120568/e8eed896-8717-4aa9-9319-dfd84505bb3e"></p>

❗️위의 구조의 경우 표현, 응용, 도메인 계층이 인프라스트럭처 계층에 종속되기 때문에 2가지의 단점이 있다.

1. 테스트 하기가 어렵다.
   - ex. 외부 시스템 연동을 위해 구현과 설정을 한 후에야 동작을 하는 지 테스트할 수 있다.

2. 구현 방식을 변경하기 어렵다.
   - 현재 구현한 기술을 다른 구현 기술로 변경하려면 현재 구현한 기술과 관련된 코드를 고쳐야 한다.

<br>

**DroolsRuleEngine** (인프라 스트럭처 계층 (구현 기술에 해당))

~~~java
public class DroolsRuleEngine {
		public void evaluate(String sessionName, List<?> facts) {
        // ...
    }
}
~~~

<br>

**CalculateDiscountService** (응용 계층)

~~~java
public class CalculateDiscountService {
    private DroolsRuleEngine ruleEngine;

    public CalculateDiscountService(DroolsRuleEngine ruleEngine) {
        this.ruleEngine = ruleEngine;
    }

    public int calculateDiscount() {
        // ...
      
				MutableMoney money = new MutableMoney(0); // Drools에 특화된 코드
        List<?> facts = Arrays.asList(money);
        ruleEngine.evaluate("discountCalculation", facts); // "discountCalculation"은 세션 이름
				
        //...
    }
}
~~~

Drools라는 **인프라스트럭처 계층에서 구현한 룰 엔진의 세션 이름을 변경할 경우 응용 계층인 CalculateDiscountService에서 코드를 수정해야 하기 때문에 응용 계층이 인프라스트럭처 계층의 기술에 의존**하게 된다. 또한 룰 엔진을 변경할 경우에도 응용 계층에서 코드를 수정해야 한다.

🤔 **이 문제를 해결 하려면 어떻게 해야 할까?**

- 의존 역전 원칙(DIP)를 적용하는 방법이 있다.



# 의존 역전 원칙 (DIP)



